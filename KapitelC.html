<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<title>PNP Projekt</title>
<meta content="Kurze Beschreibung der Webseite" name="description"/>
<meta content="Dein Name" name="author"/>
<link href="stylekapitelc.css" rel="stylesheet"/>
<link href="header.css" rel="stylesheet"/>
<script defer="" src="header.js"></script>
</head>
<body>
<header id="menu"></header>
<main class="content">
<section id="kapitel-12-level-und-xp-system"><h2>Kapitel 12-Level und XP system</h2>
  <div class="container">
    <h3>Level- und Monster-XP-Tabelle (1‚Äì100)</h3>
    <p class="description">
      <strong>Spieler-Formel:</strong> <code>XP_next = 38 √ó L<sup>2.25</sup> √ó Log2.5(L + 1)</code><br>
      <strong>Monster-Formel:</strong> <code>Monster_XP = 12 √ó L<sup>2.1</sup> √ó Log3(L + 1)</code>
    </p>

    <div class="scrollbox">
  <table class="xp-table">
    <thead>
      <tr>
        <th>Level</th>
        <th>XP F√ºr LVL(Spieler)</th>
        <th>Gesamt-XP</th>
        <th>Monster_XP</th>
        <th>Kills ‚âà</th>
      </tr>
    </thead>
    <tbody id="xp-body">
      <!-- Dynamisch generiert -->
    </tbody>
  </table>
</div>

<script>
  const tbody = document.getElementById("xp-body");
  let total = 0;

  // Hilfsfunktion f√ºr Logarithmus mit beliebiger Basis
  const logBase = (x, base) => Math.log(x) / Math.log(base);

  for (let L = 1; L <= 100; L++) {
    const xp = 38 * Math.pow(L, 2.25) * logBase(L + 1, 2.5);
    const mxp = 12 * Math.pow(L, 2.1) * logBase(L + 1, 3);
    total += xp;
    const kills = xp / mxp;

    tbody.insertAdjacentHTML(
      "beforeend",
      `
      <tr>
        <td>${L}</td>
        <td>${Math.round(xp).toLocaleString("de-DE")}</td>
        <td>${Math.round(total).toLocaleString("de-DE")}</td>
        <td>${Math.round(mxp).toLocaleString("de-DE")}</td>
        <td>${Math.round(kills)}</td>
      </tr>
      `
    );
  }
</script>

    <p class="note">
      üí° <strong>Hinweis:</strong><br>
      Die Monster-XP steigen langsamer als die Spieler-XP, damit auch hohe Level erreichbar bleiben.<br>
      Kills ‚âà zeigt, wie viele gleichstarke Gegner man im Schnitt f√ºr ein Level-Up ben√∂tigt.
    </p>
  </div>
<section id="xp-rechner" aria-labelledby="xp-rechner-title">
  <h3 id="xp-rechner-title">Level-Up Rechner</h3>

  <div class="xp-rechner-container">
    <div class="input-group">
      <label for="startLevel">Startlevel des Spielers:</label>
      <input id="startLevel" type="number" value="1" min="1" max="100" />
    </div>

    <div id="monsterContainer">
      <label>Monstergruppen:</label>
      <div class="monster-row">
        <input type="number" placeholder="Monster-Level" class="monster-level" />
        <input type="number" placeholder="Anzahl" class="monster-count" />
        <button class="delete-btn" title="Entfernen" onclick="removeMonsterRow(this)">‚ùå</button>
      </div>
    </div>

    <button type="button" class="add-btn" onclick="addMonsterRow()">‚ûï Monster hinzuf√ºgen</button>
    <button type="button" class="calc-btn" onclick="calculateXP()">Berechnen</button>

    <div id="result" role="status" aria-live="polite"></div>
  </div>

  <script>
    // Wrappe alles in DOMContentLoaded, damit das Script erst l√§uft wenn die Elemente existieren.
    document.addEventListener('DOMContentLoaded', function () {
      // ==== Korrekte Log-Basis-Funktion ====
      function logBase(x, base) {
        return Math.log(x) / Math.log(base);
      }

      // ==== XP-Formeln ====
      function playerXPForLevel(L) {
        return 38 * Math.pow(L, 2.25) * logBase(L + 1, 2.5);
      }

      function monsterXP(L) {
        return 12 * Math.pow(L, 2.1) * logBase(L + 1, 3);
      }

      function totalXPForLevel(level) {
        let total = 0;
        for (let i = 1; i <= level; i++) {
          total += playerXPForLevel(i);
        }
        return total;
      }

      // ==== DOM-Funktionen ====
      window.addMonsterRow = function () {
        const container = document.getElementById('monsterContainer');
        const row = document.createElement('div');
        row.className = 'monster-row';
        row.innerHTML = `
          <input type="number" placeholder="Monster-Level" class="monster-level" />
          <input type="number" placeholder="Anzahl" class="monster-count" />
          <button class="delete-btn" title="Entfernen" onclick="removeMonsterRow(this)">‚ùå</button>
        `;
        container.appendChild(row);
      };

      window.removeMonsterRow = function (button) {
        const row = button && button.parentElement;
        if (row && row.classList.contains('monster-row')) {
          // Wenn die letzte Zeile entfernt werden soll, lieber Felder leeren als entfernen
          const container = document.getElementById('monsterContainer');
          const rows = container.querySelectorAll('.monster-row');
          if (rows.length === 1) {
            // nur Werte l√∂schen, Zeile nicht komplett entfernen (so bleibt immer ein Eingabefeld)
            rows[0].querySelectorAll('input').forEach(i => i.value = '');
            return;
          }
          row.remove();
        }
      };

      window.calculateXP = function () {
        const startLevelInput = document.getElementById('startLevel');
        const startLevel = parseInt(startLevelInput.value, 10);
        if (isNaN(startLevel) || startLevel < 1) {
          document.getElementById('result').innerText = 'Bitte ein g√ºltiges Startlevel (1‚Äì100) eingeben.';
          return;
        }

        const monsterRows = document.querySelectorAll('#xp-rechner .monster-row');
        let totalMonsterXP = 0;
        let anyValid = false;

        monsterRows.forEach(row => {
          const lvlInput = row.querySelector('.monster-level');
          const countInput = row.querySelector('.monster-count');
          const lvl = parseFloat(lvlInput.value);
          const count = parseFloat(countInput.value);

          // nur g√ºltige und positive Werte z√§hlen
          if (!isNaN(lvl) && !isNaN(count) && lvl > 0 && count > 0) {
            totalMonsterXP += monsterXP(lvl) * count;
            anyValid = true;
          }
        });

        if (!anyValid) {
          document.getElementById('result').innerText = 'Bitte trage mindestens eine Monstergruppe mit g√ºltigem Level und Anzahl ein.';
          return;
        }

        const startXP = totalXPForLevel(startLevel);
        let newLevel = startLevel;

        // Schutz gegen Endlosschleifen: Level cap bei 100
        while (newLevel < 100 && totalXPForLevel(newLevel + 1) <= startXP + totalMonsterXP) {
          newLevel++;
        }

        const gainedLevels = newLevel - startLevel;

        document.getElementById('result').innerHTML =
          `ü™Ñ Erhaltene XP: <strong>${Math.round(totalMonsterXP).toLocaleString('de-DE')}</strong><br>` +
          `‚û°Ô∏è Neues Level: <strong>${newLevel}</strong> ( +${gainedLevels} Level${gainedLevels !== 1 ? 's' : ''} )`;
      };

      // optional: verhindern, dass Enter ein Formular absendet und die Seite refreshed
      document.getElementById('xp-rechner').addEventListener('keydown', function (e) {
        if (e.key === 'Enter') {
          const target = e.target;
          if (target && (target.classList.contains('monster-level') || target.classList.contains('monster-count') || target.id === 'startLevel')) {
            e.preventDefault();
            calculateXP();
          }
        }
      });
    });
  </script>
</section>
<h3>VL UP Belonungen:</h3>
<li>+2 Attributspunkte frei verteilen</li>
<li>+klassenspezifische LP</li>
<li>+ 1 AP</li>
<li>Alle 5 Level: 1 neue Spezialisierung ODER +3 Attributpunkte</li>
<li>F√ºr Caster alle 5 LVL 2 zauber Nach wahl</li>
</ul>
</li>
<li>Max Level = 100</li>
<li>Spezielle Stufen: ab 3, 5, 8, 10 ‚Üí neue Klassenf√§higkeiten</li>
</ul>
</section></main>
<script src="header.js"></script>
</body>
</html>
